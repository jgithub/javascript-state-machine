!function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var r="string"==typeof e.initial?{state:e.initial}:e.initial,a=e.terminal||e.final,i=n||e.target||{},o=e.events||[],s=e.callbacks||{},u={},c={},f=function(e){var n=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];u[e.name]=u[e.name]||{};for(var r=0;r<n.length;r++)c[n[r]]=c[n[r]]||[],c[n[r]].push(e.name),u[e.name][n[r]]=e.to||n[r];e.to&&(c[e.to]=c[e.to]||[])};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)f(o[l]);for(var v in u)u.hasOwnProperty(v)&&(i[v]=t.buildEvent(v,u[v]));for(var v in s)s.hasOwnProperty(v)&&(i[v]=s[v]);return i.current="none",i.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},i.can=function(e){return!this.transition&&void 0!==u[e]&&(u[e].hasOwnProperty(this.current)||u[e].hasOwnProperty(t.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},i.isFinished=function(){return this.is(a)},i.error=e.error||function(t,e,n,r,a,i,o){throw o||i},i.sameStateTransitions=!!e.sameStateTransitions,i.states=function(){return Object.keys(c).sort()},r&&!r.defer&&i[r.event](),i},doCallback:function(e,n,r,a,i,o){if(n)try{return n.apply(e,[r,a,i].concat(o))}catch(n){return e.error(r,a,i,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n)}},beforeAnyEvent:function(e,n,r,a,i){return t.doCallback(e,e.onbeforeevent,n,r,a,i)},afterAnyEvent:function(e,n,r,a,i){return t.doCallback(e,e.onafterevent||e.onevent,n,r,a,i)},leaveAnyState:function(e,n,r,a,i){return t.doCallback(e,e.onleavestate,n,r,a,i)},enterAnyState:function(e,n,r,a,i){return t.doCallback(e,e.onenterstate||e.onstate,n,r,a,i)},changeState:function(e,n,r,a,i){return t.doCallback(e,e.onchangestate,n,r,a,i)},beforeThisEvent:function(e,n,r,a,i){return t.doCallback(e,e["onbefore"+n],n,r,a,i)},afterThisEvent:function(e,n,r,a,i){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,a,i)},leaveThisState:function(e,n,r,a,i){return t.doCallback(e,e["onleave"+r],n,r,a,i)},enterThisState:function(e,n,r,a,i){return t.doCallback(e,e["onenter"+a]||e["on"+a],n,r,a,i)},beforeEvent:function(e,n,r,a,i){if(!1===t.beforeThisEvent(e,n,r,a,i)||!1===t.beforeAnyEvent(e,n,r,a,i))return!1},afterEvent:function(e,n,r,a,i){t.afterThisEvent(e,n,r,a,i),t.afterAnyEvent(e,n,r,a,i)},leaveState:function(e,n,r,a,i){var o=t.leaveThisState(e,n,r,a,i),s=t.leaveAnyState(e,n,r,a,i);return!1!==o&&!1!==s&&(t.ASYNC===o||t.ASYNC===s?t.ASYNC:void 0)},enterState:function(e,n,r,a,i){t.enterThisState(e,n,r,a,i),t.enterAnyState(e,n,r,a,i)},buildEvent:function(e,n){return function(){var r=this.current,a=n[r]||(n[t.WILDCARD]!=t.WILDCARD?n[t.WILDCARD]:r)||r,i=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,a,i,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,a,i,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,a,i))return t.Result.CANCELLED;if(r===a&&!this.sameStateTransitions)return t.afterEvent(this,e,r,a,i),t.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=a,t.enterState(o,e,r,a,i),t.changeState(o,e,r,a,i),t.afterEvent(o,e,r,a,i),t.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,t.afterEvent(o,e,r,a,i)};var s=t.leaveState(this,e,r,a,i);return!1===s?(this.transition=null,t.Result.CANCELLED):t.ASYNC===s?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.StateMachine=t):"function"==typeof define&&define.amd?define(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}();